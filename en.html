<!DOCTYPE html>
<html lang="kr">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, viewport-fit=cover, user-scalable=yes" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="shortcut icon" type="image/x-icon" href="img2/logo.png" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />

    <!-- 링크복사, 위로가기 토글 아이콘 -->
    <link rel="stylesheet" type="text/css" href="./src/framework.css" />
    <!-- 로딩 -->
    <link rel="stylesheet" type="text/css" href="./src/style.css" />
    <!-- 전체형태 -->
    <link rel="stylesheet" type="text/css" href="./src/slider.css" />
    <link rel="stylesheet" href="./src/fade.css" />

    <!-- 폰트어썸 -->
    <script type="text/javascript" src="./src/jquery.js"></script>
    <script type="text/javascript" src="./src/plugins.js"></script>
    <script type="text/javascript" src="./src/underscore.js"></script>
    <script type="text/javascript" src="./src/modernizr.custom.63321.js"></script>
    <script type="text/javascript" src="./src/custom.js"></script>
    <script charset="UTF-8" src="./src/kakao.js"></script>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/${VERSION}/kakao.min.js" integrity="${INTEGRITY_VALUE}" crossorigin="anonymous"></script>
    <script type="text/javascript" src="./src/fade.js"></script>
    <script>
        setTimeout(function () {
            location.reload();
        }, 900000); // 900000밀리초 = 900초후 페이지 새로고침
    </script>

    <meta property="og:image" content="img2/metaimg_en.png" />
    <title>New Life Welcome Sunday</title>
    <meta property="og:url" content="https://newcomer-june.netlify.app/en" />
    <meta property="og:title" content="New Life Welcome Sunday" />
    <meta property="og:description" content="Antioch Church 6/29(Sun)" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#000000" />
</head>

<body class="is-not-ios" onload="showImage()">
    <!-- 로딩 이미지 -->
    <div id="preloader" class="preloader-light">
        <div id="preload-spinner"></div>
        <h1></h1>
        <p>Loading..</p>
    </div>

    <!-- body start -->
    <div id="page-transitions" style="min-height: 592px">
        <div class="page-content" style="transition: all 300ms ease 0s">
            <div class="main-img" id="thisone">
                <img id="background letter" src="img2/background.png" alt="background" />
            </div>
            <div>
                <img class="first-part " src="img2/1.png" alt="" />
            </div>
            <div>
                <img class="first-part " src="img2/1e.png" alt="" />
            </div>            
            <div>
                <img class="first-part mt-50" src="img2/2e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/3e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/4e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/5e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/6e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/7e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/8e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/9e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/10e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/11e.png" alt="" />
            </div>
            <!-- 13e : 구미, 14e: 서울 -->
            <div>
                <img class="first-part reveal" src="img2/12e.png" alt="" />
            </div>
            <div>
                <a href="https://maps.app.goo.gl/dKLW3BvgMTdWFk13A" target="_blank">
                    <img class="first-part reveal" src="img2/13e.png" alt="" />
                </a>
            </div>
            <div>
                <a href="https://maps.app.goo.gl/i8fgpDu9VYkrQU5u8" target="_blank">
                    <img class="first-part reveal" src="img2/14e.png" alt="" />
                </a>
            </div>
            <div>
                <img class="first-part reveal" src="img2/15e.png" alt="" />
            </div>
            <div>
                <img class="first-part reveal" src="img2/16e.png" alt="" />
            </div>
            <!-- <div>
                <img class="first-part reveal" src="img2/17e.png" alt="" />
            </div> -->
            <div>
                <a href="http://antiochi.org" target="_blank">
                    <img class="first-part reveal" src="img2/17e.png" alt="" />
                </a>
            </div>

            <div class="video-container" style="width: 90%;">
                <iframe width="560" height="580" src="https://www.youtube.com/embed/b7UZm6E6V0M?si=UfodhbrY8_sCgJJ_" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                <iframe width="560" height="580" src="https://www.youtube.com/embed/d3rG1DYgMRU?si=BPF0y5n-y6K-3iYe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
            </div>

            <!-- 방명록 시작 -->
            <div class="container">
                <h2>Welcome! Guestbook</h2>
                <div class="visitor-counter" style="text-align: center; font-size: 14px; color: #4caf50; margin-top: 20px;">
                    Visitors : <span id="visitCount">...</span>
                </div>
            <input type="text" id="name" placeholder="Name" />
            <input type="password" id="password" placeholder="Password (for deletion)" />
            <textarea id="message" placeholder="Type your comment" rows="4"></textarea>
            <button onclick="submitComment()">Submit</button>
        <hr><hr>
            <h3 style="margin-top: 40px; color: #558b2f;">Comments</h3>
            <div id="commentList"></div>
            </div>

            <!-- 비밀번호 입력 모달 -->
            <div id="passwordModal">
                <div class="modal-content">
                <p>Please type your password</p>
                <input type="password" id="modalPassword" />
                <br>
                <button onclick="confirmDelete()">delete</button>
                <button onclick="closeModal()">back</button>
                </div>
            </div>

            <!-- Firebase SDK -->
            <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
            <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

            <!-- Firebase Init & Logic -->
            <script>
                const firebaseConfig = {
                        apiKey: "AIzaSyDNF6H_y3DY4G9uQntCnqlNANyFX--tC0Y",
                        authDomain: "guestbook-11b68.firebaseapp.com",
                        projectId: "guestbook-11b68",
                        storageBucket: "guestbook-11b68.firebasestorage.app",
                        messagingSenderId: "908907323574",
                        appId: "1:908907323574:web:af6f74079378d69e088617"
                    };
                firebase.initializeApp(firebaseConfig);
                const db = firebase.firestore();

                let deleteTargetId = null;

                function submitComment() {
                const name = document.getElementById('name').value.trim();
                const message = document.getElementById('message').value.trim();
                const password = document.getElementById('password').value.trim();
                if (!name || !message || !password) {
                    alert("Please enter your name, comment and password.");
                    return;
                }
                db.collection("guestbook").add({
                    name,
                    message,
                    password: String(password).trim(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    document.getElementById('name').value = '';
                    document.getElementById('message').value = '';
                    document.getElementById('password').value = '';
                    loadComments();
                });
                }

                function loadComments() {
                const container = document.getElementById('commentList');
                container.innerHTML = '';
                db.collection("guestbook").orderBy("createdAt", "desc").get().then(snapshot => {
                    snapshot.forEach(doc => {
                    const data = doc.data();
                    const commentDiv = document.createElement('div');
                    commentDiv.className = 'comment';
                    commentDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 6px; margin-top: 5px;">
                            <span style="font-size: 13px; color: #33691e; font-weight: bold; line-height: 1; margin: 0;">${data.name}</span>
                            <button onclick="openModal('${doc.id}')" style="background:#ef5350;color:white;border:none;border-radius:4px;padding:1px 6px;font-size:11px; line-height: 1;">delete</button>
                        </div>
                        <br>

                        <p style="margin: 0; font-size: 13px; line-height: 1.2;">${data.message}</p>
                        `;
                    container.appendChild(commentDiv);
                    });
                });
                }

                function openModal(id) {
                deleteTargetId = id;
                document.getElementById('modalPassword').value = '';
                document.getElementById('passwordModal').style.display = 'block';
                }

                function closeModal() {
                deleteTargetId = null;
                document.getElementById('passwordModal').style.display = 'none';
                }

                function confirmDelete() {
                const inputPw = document.getElementById('modalPassword').value;
                if (!inputPw || !deleteTargetId) return;
                db.collection("guestbook").doc(deleteTargetId).get().then(doc => {
                    if (!doc.exists) {
                    alert("Comment does not exist.");
                    return;
                    }

                    const savedPw = doc.data().password || "";
                    if (String(savedPw).trim() === String(inputPw).trim()) {
                    db.collection("guestbook").doc(deleteTargetId).delete().then(() => {
                        alert("Comment deleted.");
                        closeModal();
                        loadComments();
                    });
                    } else {
                    alert("password not matched.");
                    }
                });
                }

                window.onload = loadComments;
            </script>

            <!-- firebase 방문자 수 코드 -->
            <script>
            window.addEventListener('load', () => {
            const visitCountRef = db.collection("analytics").doc("visits");

            visitCountRef.get().then(doc => {
                if (doc.exists) {
                const current = doc.data().count || 0;
                document.getElementById("visitCount").innerText = current + 1;
                visitCountRef.update({ count: current + 1 });
                } else {
                document.getElementById("visitCount").innerText = 1;
                visitCountRef.set({ count: 1 });
                }
            });
            });
            </script>

            <div id="information1">
                <a id="copyUrl" href="#" class="copyUrl shadow-small icon icon-round no-border icon-xs bg-tumblr">
                    <i class="fa fa-link font-14 mr-10"></i>
                </a>
                <a id="copyUrl" href="#" class="copyText copyUrl nanum-font">Copy URL</a>
                <div>
                    <textarea id="url" readonly="">https://newcomer-june.netlify.app/en</textarea>
                    <script>
                        $(".copyUrl").click(function () {
                            $("#url").select();
                            document.execCommand("copy");
                            alert("url link copied.");
                        });
                    </script>
                </div>
            </div>
        
            <div id="information1">
                <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.1.0/kakao.min.js" integrity="sha384-dpu02ieKC6NUeKFoGMOKz6102CLEWi9+5RQjWSV0ikYSFFd8M3Wp2reIcquJOemx" crossorigin="anonymous"></script>
                <script>
                    if (!Kakao.isInitialized()) {
                        Kakao.init("86831dfcad2cf6f0af75f4b5e2c95965");
                    }
                    console.log("Kakao initialized:", Kakao.isInitialized());
            
                    function shareMessage() {
                        console.log("shareMessage called");
                        try {
                            Kakao.Share.sendScrap({
                                requestUrl: "https://newcomer-june.netlify.app/en",
                            });
                            console.log("Share request sent");
                        } catch (error) {
                            console.error("Share failed:", error);
                        }
                    }
                </script>
                <a href="javascript:shareMessage()" class="share-btn shadow-small icon icon-round no-border icon-xs">
                    <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png" class="sns-logo" alt="카카오톡 공유 보내기 버튼" />
                    <a href="javascript:shareMessage()" class="copyText copyUrl nanum-font">
                        Share kakaotalk
                    </a>
                </a>
            </div>

            <div id="information" class="footer-socials" style="padding-top: 50px">
                <a href="https://www.youtube.com/@hewilldoit" target="_blank" class="shadow-small icon icon-round no-border icon-xs">
                    <img src="img2\youtube-logo.png" class="sns-logo" />
                </a>
                <a href="https://soundcloud.com/wzpjxy1a1xfk" target="_blank" class="shadow-small icon icon-round no-border icon-xs">
                    <img src="img2\logo_soundcloud.jpg" class="sns-logo" />
                </a>
                <a href="https://www.instagram.com/antioch1k?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank" class="shadow-small icon icon-round no-border icon-xs">
                    <img src="./img2/insta.png" class="sns-logo" />
                </a>
            </div>

            <div id="information2" style="width: 70%; margin-top: 30px">
                <p class="copyText">
                    ©&nbsp;
                    <script>
                        document.write(new Date().getFullYear());
                    </script>
                    Antioch, all rights reserved
                </p>
            </div>
        </div>
    </div>
</body>
</html>